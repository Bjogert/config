- id: '1728191012280'
  alias: Utebelysning av vid soluppgÃ¥ng
  description: ''
  triggers:
  - event: sunrise
    trigger: sun
  conditions: []
  actions:
  - target:
      entity_id:
      - light.utelampan
    action: light.turn_off
    data: {}
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.r10_0_2
  mode: single
- id: '1728191068268'
  alias: Utebelysning pÃ¥ vid solnedgÃ¥ng
  description: ''
  triggers:
  - event: sunset
    trigger: sun
  conditions: []
  actions:
  - target:
      entity_id:
      - light.utelampan
    action: light.turn_on
    data:
      kelvin: 2853
      brightness_pct: 100
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.r10_0_2
  mode: single
- id: close_chickendoor_sundown
  alias: "ğŸ” StÃ¤ng HÃ¶nsluckan vid SolnedgÃ¥ng"
  description: 'StÃ¤nger hÃ¶nsluckan automatiskt 15 minuter efter solnedgÃ¥ng med nytt MQTT-system'
  triggers:
  - event: sunset
    offset: +00:15:00
    trigger: sun
  conditions:
  - condition: state
    entity_id: sensor.chicken_door_status
    state: 'ready'
  actions:
  - data:
      topic: chickendoor/control
      payload: close
    action: mqtt.publish
  - delay: '00:00:02'
  - data:
      message: "ğŸ” HÃ¶nsluckan stÃ¤ngs nu kl {{ now().strftime('%H:%M') }}"
    action: notify.mobile_app_telefonen
  mode: single
- id: '1730535760731'
  alias: TÃ¤nda Knapp
  description: ''
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: initial_press
    subtype: 1
    unique_id: cf724da9-036a-4ec1-bb48-250c79248d14
    trigger: device
  conditions: []
  actions:
  - action: scene.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: scene.lagom_mysigt
  mode: single
- id: '1730535913789'
  alias: SlÃ¤cka Storarummet Knapp
  description: ''
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: initial_press
    subtype: 4
    unique_id: 22313c92-ae51-4398-8a41-e3790011f018
    trigger: device
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.tanda_vanligt
  mode: single
- id: '1730560201543'
  alias: 'Toggle ljuskronan '
  description: ''
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: initial_press
    subtype: 2
    unique_id: e277d690-3ad3-4738-84c2-d4190455a104
    trigger: device
  conditions: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      entity_id: light.ljuskronan
  mode: single
- id: '1730562730263'
  alias: dimma upp ljuskrona
  description: ''
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: repeat
    subtype: 2
    unique_id: e277d690-3ad3-4738-84c2-d4190455a104
    trigger: device
  conditions: []
  actions:
  - device_id: 042d892f7a1e7637a12eb2045b5efa8c
    domain: light
    entity_id: 88f0e5ef974fbf09d7b1cb95173a9441
    type: brightness_increase
  - device_id: 1bbe6695104cda77b6ccb7767d0c88d6
    domain: light
    entity_id: a713564676bc5461293337591024a640
    type: brightness_increase
  - device_id: b64493b31278cec93d7d31365a62f80e
    domain: light
    entity_id: da12083168168a0f3f9669494b301208
    type: brightness_increase
  - device_id: cf8fb5171f99172f7068a1af8b260615
    domain: light
    entity_id: 0d71065f01967117aedd27919bad9b40
    type: brightness_increase
  - device_id: 6ba4d80f68829043c542b695e60eeb8d
    domain: light
    entity_id: 3c60a7692bd198866c1f8ea9a12177be
    type: brightness_increase
  mode: single
- id: '1730563069743'
  alias: Knapp Matbord Lampa
  description: ''
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: initial_press
    subtype: 3
    unique_id: 67bf598f-1178-490d-855f-847451af5ed6
    trigger: device
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: repeat
    subtype: 3
    unique_id: 67bf598f-1178-490d-855f-847451af5ed6
    trigger: device
  conditions: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      entity_id: light.matbord
  mode: single
- id: '1734790373118'
  alias: Mysbelysning
  description: Toggle cozy lighting mode for watching movies or relaxing.
  triggers:
  - command:
    - Jag kollar pÃ¥ TV
    - Jag kollar pÃ¥ film
    - GÃ¶r det lite mysigare i Vardagsrummet
    - GÃ¶r det lite mysigare i Storarummet
    - Det Ã¤r en stÃ¶rig reflection i tvÂ´n
    - Det Ã¤r dags fÃ¶r mys
    - mysbelysning
    - fredagsmys
    - nu ska vi mysa lite
    - Mys
    - Jag ska kolla  pÃ¥ TV
    - Jag ska kolla  pÃ¥ film
    - vi ska kolla  pÃ¥ TV
    - vi ska kolla  pÃ¥ fim
    - film time
    - filmdags
    trigger: conversation
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.on_off_plug_1_2
        state: 'off'
      sequence:
      - target:
          entity_id:
          - light.on_off_plug_1_2
          - light.farmors_lampa
        action: light.turn_on
        data: {}
    - conditions:
      - condition: state
        entity_id: light.on_off_plug_1_2
        state: 'on'
      sequence:
      - target:
          entity_id:
          - light.on_off_plug_1_2
          - light.farmors_lampa
        action: light.turn_off
        data: {}
- id: '1735757259377'
  alias: TÃ¤nd belysning i vardagsrummet kl 07
  description: Turn on living room lighting at 07:00 with conditions for darkness
    or daylight, only if you are in the home zone.
  triggers:
  - at: 07:00:00
    trigger: time
  conditions:
  - condition: zone
    entity_id: person.wiesel
    zone: zone.home
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: sun
          before: sunrise
        - condition: sun
          after: sunset
      sequence:
      - target:
          entity_id: scene.lagom_mysigt
        action: scene.turn_on
    - conditions:
      - condition: sun
        after: sunrise
        before: sunset
      sequence:
      - target:
          entity_id: scene.tant_dag
        action: scene.turn_on
  mode: single
- id: '1735857336394'
  alias: TÃ¤nda Knapp - Long Press
  description: Activate 'lagom mysigt' on long press.
  triggers:
  - device_id: e79842dedc51d54a05755c9e99255027
    domain: hue
    type: long_press
    subtype: 1
    unique_id: cf724da9-036a-4ec1-bb48-250c79248d15
    trigger: device
  conditions: []
  actions:
  - action: scene.turn_on
    data:
      transition: 3
    target:
      entity_id: scene.tant_dag
  mode: single
- id: '1736089877913'
  alias: Activate Lagom Mysigt After Sundown
  description: Turns on scene.lagom_mysigt after sundown if scene.tant_dag is active.
  triggers:
  - event: sunset
    trigger: sun
  conditions:
  - condition: state
    entity_id: scene.tant_dag
    state: 'on'
  actions:
  - target:
      entity_id: scene.lagom_mysigt
    action: scene.turn_on
  mode: single
- id: '1736837691791'
  alias: VÃ¤xtljus pÃ¥ kl 08
  description: ''
  triggers:
  - trigger: time
    at: 07:00:00
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.on_off_plug_2
  mode: single
- id: '1736882212502'
  alias: VÃ¤xtljus av 20:00
  description: ''
  triggers:
  - trigger: time
    at: '20:00:00'
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.on_off_plug_2
  mode: single
- id: '1738834919357'
  alias: Adjust VLC Volume
  description: ''
  triggers:
  - entity_id: input_number.vlc_volume
    trigger: state
  actions:
  - target:
      entity_id: media_player.vlc_telnet
    data:
      volume_level: '{{ states(''input_number.vlc_volume'') | float }}'
    action: media_player.volume_set
  mode: single
- id: '1739013104752'
  alias: Track Last Activated Scene
  triggers:
  - event_type: call_service
    event_data:
      domain: scene
      service: turn_on
    trigger: event
  actions:
  - target:
      entity_id: input_text.last_active_scene
    data:
      value: >-
        {% if trigger.event.data.service_data.entity_id is string %}
          {{ trigger.event.data.service_data.entity_id.split('.')[1] }}
        {% elif trigger.event.data.service_data.entity_id is iterable %}
          {{ trigger.event.data.service_data.entity_id[0].split('.')[1] }}
        {% else %}
          unknown
        {% endif %}
    action: input_text.set_value
  mode: single
- id: '1743797920755'
  alias: Spela P4 GÃ¶teborg kl 06 pÃ¥ vardagar
  description: ''
  triggers:
  - at: 06:00:00
    trigger: time
  conditions:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  actions:
  - data:
      entity_id: media_player.vlc_telnet
      volume_level: 0.22
    action: media_player.volume_set
  - data:
      kanal_namn: P4 GÃ¶teborg
      media_content_id: https://http-live.sr.se/p4goteborg-mp3-192
    action: script.starta_radio
  mode: single
- id: '1747062259790'
  alias: Uppdatera hissens hastighet
  description: Skickar nytt motorSpeed till ESP32 via MQTT
  triggers:
  - entity_id: input_number.beer_elevator_speed
    trigger: state
  conditions: []
  actions:
  - data:
      topic: beer_elevator/config/speed
      payload: '{{ states(''input_number.beer_elevator_speed'') | int }}'
    action: mqtt.publish
  mode: single
- id: '1747074152038'
  alias: Uppdatera hissacceleration
  description: Skickar det nya accel-vÃ¤rdet till ESP32 via MQTT
  triggers:
  - entity_id: input_number.beer_elevator_acceleration
    trigger: state
  conditions: []
  actions:
  - data:
      topic: beer_elevator/config/acceleration
      payload: '{{ states(''input_number.beer_elevator_acceleration'') | int }}'
    action: mqtt.publish
  mode: single
- id: '1747079959141'
  alias: Uppdatera Extra Steg UppÃ¥t
  description: ''
  triggers:
  - entity_id: input_number.beer_elevator_extra_steps_up
    trigger: state
  actions:
  - data:
      topic: beer_elevator/config/extra_steps_up
      payload: '{{ states(''input_number.beer_elevator_extra_steps_up'') | int }}'
    action: mqtt.publish
  mode: single
- id: '1747079974479'
  alias: Uppdatera Extra Steg NedÃ¥t
  description: ''
  triggers:
  - entity_id: input_number.beer_elevator_extra_steps_down
    trigger: state
  actions:
  - data:
      topic: beer_elevator/config/extra_steps_down
      payload: '{{ states(''input_number.beer_elevator_extra_steps_down'') | int }}'
    action: mqtt.publish
  mode: single
- id: 'duck_door_open_morning'
  alias: "ğŸ¦† Ã–ppna Ankluckan kl 08:00"
  description: 'Ã–ppnar ankluckan kl 08:00 varje morgon'
  triggers:
  - at: '08:00:00'
    trigger: time
  conditions: 
  - condition: state
    entity_id: sensor.duck_door_status
    state: 'closed'
  actions:
  - data:
      topic: duck/door/command
      payload: open
    action: mqtt.publish
  - delay: '00:00:02'
  - data:
      message: "ğŸ¦† Ankluckan Ã¶ppnas nu kl {{ now().strftime('%H:%M') }}"
    action: notify.mobile_app_telefonen
  mode: single
- id: 'duck_door_auto_close_after_chicken'
  alias: "ğŸ¦† StÃ¤ng Ankluckan Efter HÃ¶nsluckan"
  description: 'StÃ¤nger ankluckan 16 minuter efter att hÃ¶nsluckan stÃ¤ngts framgÃ¥ngsrikt'
  triggers:
  - entity_id: sensor.chicken_door_status
    to: 'ready'
    from: 'closing'
    trigger: state
  conditions:
  - condition: state
    entity_id: sensor.duck_door_status
    state: 'open'
  actions:
  - delay: '00:16:00'
  - data:
      topic: duck/door/command
      payload: close
    action: mqtt.publish
  - delay: '00:00:02'
  - data:
      message: "ğŸ¦† Ankluckan stÃ¤ngs 5 minuter efter hÃ¶nsluckan - {{ now().strftime('%H:%M') }}"
    action: notify.mobile_app_telefonen
  mode: single
- id: '1748016432843'
  alias: "ğŸ¦† Ankluckan - Statusnotifieringar"
  description: 'Skickar notifieringar fÃ¶r ankluckans statusÃ¤ndringar och fel'
  triggers:
  - entity_id: sensor.duck_door_status
    to: 'closed'
    trigger: state
  - entity_id: sensor.duck_door_status  
    to: 'open'
    trigger: state
  - entity_id: sensor.duck_door_status
    to: 'error'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ trigger.to_state.state == 'closed' }}"
      sequence:
      - data:
          message: "ğŸ¦† Ankluckan STÃ„NGD framgÃ¥ngsrikt - Position: {{ states('sensor.duck_door_position') }}"
        action: notify.mobile_app_telefonen
    - conditions:
      - condition: template
        value_template: "{{ trigger.to_state.state == 'open' }}"
      sequence:
      - data:
          message: "ğŸ¦† Ankluckan Ã–PPNAD framgÃ¥ngsrikt - Position: {{ states('sensor.duck_door_position') }}"
        action: notify.mobile_app_telefonen
    - conditions:
      - condition: and
        conditions:
        - condition: template
          value_template: "{{ trigger.to_state.state == 'error' }}"
        - condition: numeric_state
          entity_id: input_number.duck_door_notification_count
          below: 2
      sequence:
      - data:
          message: "âš ï¸ ANKLUCKA FEL - Kontrollera omedelbart! Status: fel"
        action: notify.mobile_app_telefonen
      - action: input_number.increment
        target:
          entity_id: input_number.duck_door_notification_count
  mode: single
- id: '1748798806300'
  alias: "ğŸ” HÃ¶nsluckan - Endast Viktiga Notifieringar"
  description: 'Skickar notifieringar endast nÃ¤r luckan stÃ¤ngs framgÃ¥ngsrikt eller misslyckas med att stÃ¤ngas'
  triggers:
  - entity_id: sensor.chicken_door_status
    to: 'ready'
    from: 'closing'
    trigger: state
  - entity_id: sensor.chicken_door_status
    to: 'emergency_stop'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ trigger.to_state.state == 'ready' and trigger.from_state.state == 'closing' }}"
      sequence:
      - data:
          message: "ğŸ” HÃ¶nsluckan STÃ„NGD framgÃ¥ngsrikt - HÃ¶norna Ã¤r sÃ¤kra! ğŸ›¡ï¸"
        action: notify.mobile_app_telefonen
    - conditions:
      - condition: template
        value_template: "{{ trigger.to_state.state == 'emergency_stop' }}"
      sequence:
      - data:
          message: "âš ï¸ HÃ–NSLUCKAN MISSLYCKADES ATT STÃ„NGAS - NÃ¶dstopp aktiverat!"
        action: notify.mobile_app_telefonen
  mode: single

- id: badtunnan_availability_notification
  alias: "ğŸŒ¡ï¸ Badtunnan Temp - Online/Offline Notification"
  description: 'Sends notification when Badtunnan Temp sensor goes online or offline, limited to 2 notifications per day. Offline notifications delayed by 15 minutes.'
  triggers:
  - entity_id: sensor.esp32_temperature_7
    trigger: state
    to: "unavailable"
    for: "00:15:00"
  - entity_id: sensor.esp32_temperature_7
    trigger: state
    from: "unavailable"
  conditions:
  - condition: numeric_state
    entity_id: input_number.badtunnan_notification_count
    below: 2
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.esp32_temperature_7
        state: "unavailable"
      sequence:
      - data:
          message: "ğŸŒ¡ï¸ Badtunnan Temp sensor Ã¤r OFFLINE i 15+ minuter! ğŸ“´"
          title: "Sensor Offline"
        action: notify.mobile_app_telefonen
    default:
    - data:
        message: "ğŸŒ¡ï¸ Badtunnan Temp sensor Ã¤r tillbaka ONLINE! âœ…"
        title: "Sensor Online"
      action: notify.mobile_app_telefonen
  - action: input_number.increment
    target:
      entity_id: input_number.badtunnan_notification_count
  mode: single

- id: reset_badtunnan_notification_counter
  alias: "ğŸ”„ Reset Badtunnan Notification Counter"
  description: 'Resets the daily notification counter at midnight'
  triggers:
  - at: '00:00:00'
    trigger: time
  conditions: []
  actions:
  - action: input_number.set_value
    target:
      entity_id: input_number.badtunnan_notification_count
    data:
      value: 0
  mode: single

- id: reset_duck_door_notification_counter
  alias: "ğŸ”„ Reset Duck Door Notification Counter"
  description: 'Resets the daily notification counter at midnight'
  triggers:
  - at: '00:00:00'
    trigger: time
  conditions: []
  actions:
  - action: input_number.set_value
    target:
      entity_id: input_number.duck_door_notification_count
    data:
      value: 0
  mode: single

# ================================
# CHICKEN MONITORING AUTOMATIONS
# ================================
# Note: These automations are temporarily disabled until:
# 1. Input helpers are created manually via UI
# 2. ESP32 RFID system is set up and running

# - id: track_chicken_visits
#   alias: "ğŸ” Track Chicken Nest Visits"
#   description: 'Updates counters and logs when chickens visit the nest'
#   triggers:
#   - entity_id: sensor.chicken_visits_log
#     trigger: state
#   conditions:
#   - condition: template
#     value_template: "{{ trigger.to_state.state != 'No visits' and trigger.to_state.state != 'unknown' }}"
#   actions:
#   - action: input_number.increment
#     target:
#       entity_id: input_number.daily_chicken_visits
#   - action: input_number.increment
#     target:
#       entity_id: input_number.weekly_chicken_visits
#   - action: input_text.set_value
#     target:
#       entity_id: input_text.current_nest_occupant
#     data:
#       value: "{{ trigger.to_state.state }}"
#   - data:
#       message: "ğŸ” {{ trigger.to_state.state }} just visited the nest! Total visits today: {{ states('input_number.daily_chicken_visits') | int }}"
#     action: notify.mobile_app_telefonen
#   mode: single

# - id: update_nest_occupant
#   alias: "ğŸ” Update Current Nest Occupant"
#   description: 'Tracks who is currently in the nest'
#   triggers:
#   - entity_id: sensor.nest_1_occupant
#     trigger: state
#   conditions: []
#   actions:
#   - action: input_text.set_value
#     target:
#       entity_id: input_text.current_nest_occupant
#     data:
#       value: "{{ trigger.to_state.state if trigger.to_state.state != 'unknown' else 'empty' }}"
#   mode: single

# - id: announce_daily_chicken_champion
#   alias: "ğŸ† Announce Daily Chicken Champion"
#   description: 'Announces the most productive chicken at 6 PM'
#   triggers:
#   - at: '18:00:00'
#     trigger: time
#   conditions:
#   - condition: numeric_state
#     entity_id: input_number.daily_chicken_visits
#     above: 0
#   actions:
#   - action: notify.mobile_app_telefonen
#     data:
#       message: "ğŸ† Dagens HÃ¶nschampion: {{ state_attr('sensor.chicken_leaderboard', 'leaderboard')[0].name if state_attr('sensor.chicken_leaderboard', 'leaderboard') else 'Ingen aktivitet idag' }}! Totalt {{ states('input_number.daily_chicken_visits') }} besÃ¶k idag."
#       title: "ğŸ” Daglig HÃ¶nsrapport"
#   mode: single

# - id: reset_daily_chicken_counters
#   alias: "ğŸ”„ Reset Daily Chicken Counters"
#   description: 'Resets daily chicken visit counters at midnight'
#   triggers:
#   - at: '00:00:00'
#     trigger: time
#   conditions: []
#   actions:
#   - action: input_number.set_value
#     target:
#       entity_id: input_number.daily_chicken_visits
#     data:
#       value: 0
#   - action: input_text.set_value
#     target:
#       entity_id: input_text.daily_chicken_champion
#     data:
#       value: ""
#   mode: single

# - id: reset_weekly_chicken_counters
#   alias: "ğŸ”„ Reset Weekly Chicken Counters"
#   description: 'Resets weekly chicken visit counters on Monday at midnight'
#   triggers:
#   - at: '00:00:00'
#     trigger: time
#   conditions:
#   - condition: time
#     weekday:
#     - mon
#   actions:
#   - action: input_number.set_value
#     target:
#       entity_id: input_number.weekly_chicken_visits
#     data:
#       value: 0
#   - action: input_text.set_value
#     target:
#       entity_id: input_text.weekly_chicken_champion
#     data:
#       value: ""
#   mode: single

# - id: chicken_productivity_alert
#   alias: "ğŸ“Š Chicken Productivity Alert"
#   description: 'Alert if chicken activity is unusually low'
#   triggers:
#   - at: '12:00:00'
#     trigger: time
#   conditions:
#   - condition: numeric_state
#     entity_id: input_number.daily_chicken_visits
#     below: 5
#   actions:
#   - action: notify.mobile_app_telefonen
#     data:
#       message: "ğŸ“Š LÃ¥g hÃ¶nsaktivitet idag: endast {{ states('input_number.daily_chicken_visits') }} besÃ¶k sÃ¥ hÃ¤r lÃ¥ngt. Kolla sÃ¥ allt Ã¤r okej med hÃ¶norna!"
#       title: "ğŸ” Produktivitetsvarning"
#   mode: single

